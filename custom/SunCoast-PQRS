/**
 * Copyright (C) 2016      Suncoast Connection
 * @author DPRoberts
 * SIMPLE IS BETTER - ?
 * Needs to do ONLY ONE THING Print PQRS forms
 * probably read as one long string of JSON - works for web and PHP
 * read as arrays because PHP does arrays well
 * so that means there are three arrays as I use them below - of course they can be one stream split etc
 * the first array is constant for each submision and it is the
 * FADarray =[ReportCreationDate,ReportCreationTime,ReportCreationRegistry,etc];
 * The second array contains the third array? 
 * The second array is the Measures groups reported array -> mostly going to be only one but this allows for multiples
 * The second array leads with the number of measure groups -> this tells how many times to loop through the data
 * each of the other Measure Data spots is a multiple of this ie. the first one is position 1,31,61 etc...
 * The third array is the pqrs measure Details array which is 
 */

var fs = require('fs');
var ReportCreationDate = '01-23-2015';
var ReportCreationTime ='23:01';
var ReportCreationRegistry = "lou";
var FileAuditDataVersion = 1;
var FileNumber =1;
var NumberOfiles =1 ;
var RegistryName = "lou";
var RegistryId = 1;
var SubmissionType = 1 ; // one or two or A?
var SubmissionMethod = 1;
var numberOmeasures = 2;// this should really be dynamically read no its read incomming and solid here
var wstream = fs.createWriteStream('PQRS.xml');
var FADarray =[ReportCreationDate,ReportCreationTime,ReportCreationRegistry];
var MeasureDataArray = [1,'A','gt',3,4,'pnm','cm'];
var NumberMeasuresReported = MeasureDataArray[0];
var NMRcounter = 0;
var MDAcounter =0;
var MeasureGroupID;
//for (i=NMRcounter; i< NumberMeasuresReported; i++ )
var PQRSmeasureDetails = [[1,'msn'],2]; // created from stream or read in separately
// multiple measure groups will make this an array of arrays
var mdetailarray =[];



wstream.write('<?xml version="1.0" encoding="UTF-8" ?>\n');
wstream.write('<submission type="PQRS-REGISTRY" version="7.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="Registry_Payment.xsd"></submission>\n');
wstream.write('  <file-audit-data>\n');
wstream.write('     <create-date>'+ FADarray[0]+'</create-date>'+'\n');
wstream.write('     <create-time>'+ReportCreationTime+'</create-time>'+'\n');
wstream.write('     <create-by>'+ReportCreationRegistry+'</create-by>'+'\n');
wstream.write('     <version>'+FileAuditDataVersion+'</version>'+'\n');
wstream.write('     <file-number>'+FileNumber+'</file-number>'+'\n');
wstream.write('     <number-of-files>'+NumberOfiles+'</number-of-files>'+'\n');
wstream.write('   </file-audit-data>\n');
wstream.write('<registry>\n');
wstream.write('   <registry-name>'+RegistryName+'</registry-name>'+'\n');
wstream.write('   <registry-id>'+RegistryId+'</registry-id>'+'\n');
wstream.write('   <submission-type>'+SubmissionType+'</fsubmission-type>'+'\n');
wstream.write('   <submission-method>'+SubmissionMethod+'</submission-method>'+'\n');
wstream.write('</registry>\n');
//larger loop here for multiple Methods Reported.



NumbMeasuresReported = MeasureDataArray[0];

    do {
    	wstream.write('<measure-group ID ='+ MeasureDataArray[NMRcounter*1] + '>\n');   
    	   wstream.write('  <provider>\n');
   				wstream.write('   <gpro-type>'+MeasureDataArray[NMRcounter*1+1]+'</gpro-type>'+'\n');
   	// bunch of stuff here
					 wstream.write('<pqrs-measure>\n'); 
  					     wstream.write('   <pqrs-measure-number>'+MeasureDataArray[NMRcounter*1+5]+'</pqrs-measure-number>'+'\n');
   					     wstream.write('   <collection-method>'+MeasureDataArray[NMRcounter*1+6]+'</collection-method>'+'\n');
   					        wstream.write('      <ppqrs-measure-details>\n');
   		 // the pqrs measure details loop start here runs of different array the counter of which is place after the collection method
   		 
   		 mdetailarray = PQRSmeasureDetails[NMRcounter];
   		 numberOmeasureNumbers = mdetailarray.length;
   		 MDAcounter = 0;
   		 
					   do {		     
                              wstream.write('        <measure-strat-num>'+ mdetailarray[MDAcounter*1+1]+'</measure-strat-num>'+'\n');
   					 
   					      // second bunch of stuff here   	

   					            MDAcounter += 1;
   					          } while (MDAcounter < numberOmeasureNumbers);
   					          
   					          wstream.write('      </ppqrs-measure-details>\n');
   					    wstream.write('   </pqrs-measure>\n'); 
   					wstream.write('  </provider>\n');
   				wstream.write('</measure-group>\n');
   					
    				NMRcounter += 1;
    				}while (NMRcounter < NumberMeasuresReported);
    
    
wstream.end();


